<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>美团代付 - 邀请好友付款</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        }
        body {
            background-color: #f5f5f5;
            padding-bottom: 30px;
        }
        /* 顶部导航栏 */
        .header {
            background: #fff;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .back-btn {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }
        .header-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        .share-btn, .forward-btn, .config-btn {
            color: #ffc107;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .share-btn:hover, .forward-btn:hover, .config-btn:hover {
            background-color: #fff8e6;
        }
        /* 分享弹窗 */
        .share-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 9999;
            display: none;
        }
        .share-popup {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #fff;
            border-radius: 12px 12px 0 0;
            padding: 20px;
            z-index: 10000;
            display: none;
        }
        .share-title {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        .share-options {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .share-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        .share-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 24px;
        }
        .wechat-icon {
            background-color: #07c160;
        }
        .qq-icon {
            background-color: #12b7f5;
        }
        .copy-icon {
            background-color: #ffc107;
        }
        .share-text {
            font-size: 14px;
            color: #666;
        }
        .share-close {
            width: 100%;
            padding: 12px;
            background-color: #f5f5f5;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
            cursor: pointer;
        }
        /* 转发弹窗 */
        .forward-popup {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #fff;
            border-radius: 12px 12px 0 0;
            padding: 20px;
            z-index: 10001;
            display: none;
        }
        .forward-title {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        .forward-desc {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-bottom: 16px;
            padding: 0 20px;
        }
        /* 主体内容容器 */
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 16px;
        }
        /* 用户信息区 */
        .user-info {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid #f0f0f0;
        }
        .user-meta {
            flex: 1;
        }
        .user-name {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }
        .user-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }
        /* 支付核心区 */
        .pay-card {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            margin-top: 16px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .pay-label {
            font-size: 14px;
            color: #999;
            margin-bottom: 8px;
        }
        .pay-amount {
            font-size: 48px;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
            letter-spacing: -1px;
        }
        .countdown {
            font-size: 14px;
            color: #ff4444;
            background: #fff8f8;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 24px;
        }
        .countdown.paid {
            color: #07c160;
            background: #f0fdf4;
        }
        .countdown span {
            font-weight: 600;
            margin: 0 2px;
        }
        .pay-btn {
            width: 100%;
            background: #ffc107;
            color: #000;
            border: none;
            border-radius: 8px;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 12px;
        }
        .pay-btn:active {
            background: #ffb700;
        }
        .pay-btn.disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .pay-btn.paid {
            background: #07c160;
            color: #fff;
        }
        .self-pay {
            font-size: 14px;
            color: #666;
            text-align: center;
        }
        .self-pay a {
            color: #666;
            text-decoration: none;
            font-weight: 500;
        }
        /* 订单详情区 */
        .order-detail {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }
        .detail-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .shop-name {
            color: #333;
        }
        .detail-more {
            color: #ffc107;
            font-size: 14px;
            cursor: pointer;
        }
        .goods-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 16px;
        }
        .goods-item {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        .goods-item:last-child {
            border-bottom: none;
        }
        .goods-img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }
        .goods-meta {
            flex: 1;
            text-align: left;
        }
        .goods-name {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .goods-price {
            font-size: 16px;
            font-weight: 600;
            color: #ff4444;
            margin-bottom: 4px;
        }
        .goods-count {
            font-size: 14px;
            color: #999;
        }
        .goods-del {
            color: #ff4444;
            font-size: 12px;
            cursor: pointer;
            margin-top: 4px;
        }
        .add-goods-btn {
            width: 100%;
            padding: 10px;
            background-color: #fff8e6;
            border: 1px dashed #ffc107;
            border-radius: 8px;
            color: #ff9800;
            font-size: 14px;
            cursor: pointer;
            margin-top: 12px;
        }
        /* 订单备注样式 */
        .order-note {
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
        }
        .order-note-title {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }
        .order-note-content {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }
        /* 备注说明区 */
        .remark {
            background: #fff8e6;
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 16px;
            font-size: 12px;
            color: #ff9800;
            line-height: 1.5;
        }
        /* 收款码弹窗 */
        .mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 99;
            display: none;
        }
        .pay-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            z-index: 100;
            display: none;
            width: 90%;
            max-width: 320px;
        }
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }
        .code-group {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .code-item {
            text-align: center;
        }
        .code-img {
            width: 180px;
            height: 180px;
            object-fit: cover;
            margin: 0 auto 8px;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
        }
        /* 长按识别提示样式 */
        .code-tip {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
            padding: 4px 8px;
            background-color: #f5f5f5;
            border-radius: 4px;
            display: inline-block;
        }
        .code-desc {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }
        .close-modal {
            width: 100%;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            color: #333;
            cursor: pointer;
            margin-top: 20px;
        }
        /* 支付成功弹窗 */
        .success-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 20000;
            display: none;
        }
        .success-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border-radius: 12px;
            padding: 32px 24px;
            z-index: 20001;
            display: none;
            width: 90%;
            max-width: 300px;
            text-align: center;
        }
        .success-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            background-color: #07c160;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 32px;
        }
        .success-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .success-desc {
            font-size: 14px;
            color: #666;
            margin-bottom: 24px;
        }
        .success-btn {
            width: 100%;
            background: #07c160;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            cursor: pointer;
        }
        /* 微信内转账引导弹窗 */
        .wechat-transfer-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            z-index: 10002;
            display: none;
            width: 90%;
            max-width: 320px;
            text-align: center;
        }
        .transfer-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
        }
        .transfer-amount {
            font-size: 24px;
            font-weight: 700;
            color: #ff4444;
            margin-bottom: 12px;
        }
        .transfer-note {
            background-color: #f5f5f5;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
            color: #333;
            display: inline-block;
        }
        .transfer-steps {
            text-align: left;
            margin-bottom: 24px;
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }
        .transfer-steps li {
            margin-bottom: 8px;
        }
        .copy-note-btn {
            width: 100%;
            background: #07c160;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 12px;
        }
        .close-transfer-btn {
            width: 100%;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            color: #333;
            cursor: pointer;
        }
        /* 配置面板（默认隐藏） */
        .config-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: 999;
            padding: 20px;
            overflow-y: auto;
            display: none;
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .panel-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        .close-panel {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }
        .config-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .form-label {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }
        .form-input, .form-textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            color: #333;
        }
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        /* 多商品配置区域 */
        .goods-config-area {
            margin-bottom: 16px;
        }
        .goods-config-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
        }
        .single-goods-form {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            border: 1px dashed #ddd;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        .goods-form-row {
            display: flex;
            gap: 8px;
        }
        .goods-form-row .form-input {
            flex: 1;
        }
        .del-goods-form-btn {
            padding: 0 12px;
            background-color: #fff;
            border: 1px solid #ff4444;
            color: #ff4444;
            border-radius: 4px;
            cursor: pointer;
        }
        .add-goods-form-btn {
            width: 100%;
            padding: 10px;
            background-color: #fff8e6;
            border: 1px dashed #ffc107;
            border-radius: 8px;
            color: #ff9800;
            font-size: 14px;
            cursor: pointer;
            margin-top: 8px;
        }
        .save-config {
            background: #ffc107;
            color: #000;
            border: none;
            border-radius: 8px;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }
        /* 响应式适配 */
        @media (max-width: 375px) {
            .pay-amount {
                font-size: 42px;
            }
            .goods-img {
                width: 70px;
                height: 70px;
            }
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <div class="header">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5OTk5OTkiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMjEgMTFIM2MtLjU1IDAtMS4wNS40NS0xIDEgMCAuMTguMDQuMzUuMDkuNTdsNiA2YzEuMjQgMS4yNCAzLjIyIDEuMjQgNC40NiAwbDYtNmMuMTUtLjE1LjI3LS4zOS4yOS0uNjVjMC0uNTUtLjQ1LTEtMS0xek0xOSAxMUw5IDE5VjV6Ii8+PC9zdmc+" alt="返回" class="back-btn" onclick="window.history.back()">
        <div class="header-title">邀请好友代付</div>
        <div>
            <span class="share-btn" onclick="showSharePopup()">分享</span>
            <span class="forward-btn" onclick="showForwardPopup()">转发</span>
            <span class="config-btn" onclick="showConfigPanel()">配置</span>
        </div>
    </div>

    <!-- 分享弹窗 -->
    <div class="share-mask" id="shareMask" onclick="hideSharePopup()"></div>
    <div class="share-popup" id="sharePopup">
        <div class="share-title">分享给好友</div>
        <div class="share-options">
            <div class="share-item" onclick="shareToWechat()">
                <div class="share-icon wechat-icon">微</div>
                <div class="share-text">微信好友</div>
            </div>
            <div class="share-item" onclick="shareToQQ()">
                <div class="share-icon qq-icon">Q</div>
                <div class="share-text">QQ好友</div>
            </div>
            <div class="share-item" onclick="copyLink()">
                <div class="share-icon copy-icon">链</div>
                <div class="share-text">复制链接</div>
            </div>
        </div>
        <button class="share-close" onclick="hideSharePopup()">取消</button>
    </div>

    <!-- 转发弹窗 -->
    <div class="share-mask" id="forwardMask" onclick="hideForwardPopup()"></div>
    <div class="forward-popup" id="forwardPopup">
        <div class="forward-title">转发订单</div>
        <div class="forward-desc">将此代付订单转发给其他好友，请求帮忙付款</div>
        <div class="share-options">
            <div class="share-item" onclick="forwardToWechat()">
                <div class="share-icon wechat-icon">微</div>
                <div class="share-text">微信好友</div>
            </div>
            <div class="share-item" onclick="forwardToQQ()">
                <div class="share-icon qq-icon">Q</div>
                <div class="share-text">QQ好友</div>
            </div>
            <div class="share-item" onclick="copyForwardLink()">
                <div class="share-icon copy-icon">链</div>
                <div class="share-text">复制链接</div>
            </div>
        </div>
        <button class="share-close" onclick="hideForwardPopup()">取消</button>
    </div>

    <!-- 主体内容 -->
    <div class="container">
        <!-- 用户信息区 -->
        <div class="user-info">
            <img src="https://imgchr.com/i/6Z7X8K" alt="用户头像" class="user-avatar" id="avatar-img">
            <div class="user-meta">
                <div class="user-name" id="user-name">小团同学</div>
                <div class="user-desc" id="user-desc">想喝奶茶啦，求好友赞助~</div>
            </div>
        </div>

        <!-- 支付核心区 -->
        <div class="pay-card">
            <div class="pay-label">需支付金额</div>
            <div class="pay-amount" id="pay-amount">¥26.50</div>
            <div class="countdown" id="countdown">
                支付剩余时间 <span id="time-h">00</span>:<span id="time-m">15</span>:<span id="time-s">00</span>
            </div>
            <button class="pay-btn" id="payBtn" onclick="checkWechatEnv()">微信/支付宝支付</button>
            <button class="pay-btn paid" id="paidBtn" style="display: none;" onclick="showSuccessPopup()">我已付款</button>
            <div class="self-pay"><a href="javascript:;">自己付款 ></a></div>
        </div>

        <!-- 订单详情区 -->
        <div class="order-detail">
            <div class="detail-title">
                <span class="shop-name" id="shop-name">蜜雪冰城（通运路店）</span>
                <span class="detail-more">订单详情</span>
            </div>
            <div class="goods-list" id="goodsList">
                <div class="goods-item">
                    <img src="https://imgchr.com/i/7ZJvq1" alt="商品图片" class="goods-img" data-id="0">
                    <div class="goods-meta">
                        <div class="goods-name">珍珠奶茶（中杯）</div>
                        <div class="goods-price">¥12.50</div>
                        <div class="goods-count">1份 · 无需备注</div>
                        <div class="goods-del" onclick="deleteGoods(0)">删除</div>
                    </div>
                </div>
                <div class="goods-item">
                    <img src="https://imgchr.com/i/7ZJvq1" alt="商品图片" class="goods-img" data-id="1">
                    <div class="goods-meta">
                        <div class="goods-name">脆筒冰淇淋</div>
                        <div class="goods-price">¥3.00</div>
                        <div class="goods-count">1份 · 无需备注</div>
                        <div class="goods-del" onclick="deleteGoods(1)">删除</div>
                    </div>
                </div>
            </div>
            <button class="add-goods-btn" onclick="addGoods()">+ 添加商品</button>
            
            <!-- 订单备注展示区 -->
            <div class="order-note">
                <div class="order-note-title">订单备注</div>
                <div class="order-note-content" id="orderNoteContent">麻烦尽快付款哦，奶茶要趁热喝~</div>
            </div>
        </div>

        <!-- 备注说明区 -->
        <div class="remark">
            1. 代付订单创建后15分钟内未支付将自动取消；<br>
            2. 代付成功后，退款将原路退回代付人账户；<br>
            3. 请好友扫码支付时核对金额无误后再付款~
        </div>
    </div>

    <!-- 收款码弹窗（已添加跳转功能） -->
    <div class="mask" id="payMask" onclick="closePayModal()"></div>
    <div class="pay-modal" id="payModal">
        <div class="modal-title">选择支付方式</div>
        <div class="code-group">
            <div class="code-item" id="wx-pay-container">
                <!-- 已替换为你的新二维码 + 跳转链接 -->
                <a href="https://wx.tenpay.com/f2f?m=xxx&u=xxx&a=xxx" target="_blank">
                  <img src="https://imgchr.com/i/8Z6g01" alt="微信收款码" class="code-img" id="wx-code-img">
                </a>
                <div class="code-desc">微信扫码付款</div>
                <div class="code-tip">点击图片直接跳转支付</div>
            </div>
            <div class="code-item">
                <img src="https://imgchr.com/i/8Z5a0e" alt="支付宝收款码" class="code-img" id="ali-code-img">
                <div class="code-desc">支付宝扫码付款</div>
                <div class="code-tip">长按识别二维码</div>
            </div>
        </div>
        <button class="close-modal" onclick="closePayModal()">关闭</button>
        <button class="pay-btn paid" style="margin-top: 12px;" onclick="closePayModal();showSuccessPopup()">我已完成付款</button>
    </div>

    <!-- 支付成功弹窗 -->
    <div class="success-mask" id="successMask" onclick="closeSuccessPopup()"></div>
    <div class="success-popup" id="successPopup">
        <div class="success-icon">✓</div>
        <div class="success-title">支付反馈成功</div>
        <div class="success-desc">订单状态已更新，感谢你的帮助~</div>
        <button class="success-btn" onclick="closeSuccessPopup()">我知道了</button>
    </div>

    <!-- 微信内转账引导弹窗 -->
    <div class="mask" id="transferMask" onclick="closeTransferModal()"></div>
    <div class="wechat-transfer-modal" id="transferModal">
        <div class="transfer-title">微信内转账指引</div>
        <div class="transfer-amount" id="transferAmount">¥26.50</div>
        <div class="transfer-note" id="transferNote">代付订单：珍珠奶茶+脆筒冰淇淋</div>
        <ul class="transfer-steps">
            <li>1. 点击下方按钮复制转账备注</li>
            <li>2. 返回微信首页，点击右上角「+」→「转账」</li>
            <li>3. 选择付款人，粘贴备注并输入金额</li>
            <li>4. 完成转账后点击「我已付款」</li>
        </ul>
        <button class="copy-note-btn" onclick="copyTransferNote()">复制转账备注</button>
        <button class="close-transfer-btn" onclick="closeTransferModal()">关闭</button>
    </div>

    <!-- 配置面板（默认隐藏） -->
    <div class="config-panel" id="configPanel">
        <div class="panel-header">
            <div class="panel-title">订单配置中心</div>
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5OTk5OTkiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMjEgMTFIM2MtLjU1IDAtMS4wNS40NS0xIDEgMCAuMTguMDQuMzUuMDkuNTdsNiA2YzEuMjQgMS4yNCAzLjIyIDEuMjQgNC40NiAwbDYtNmMuMTUtLjE1LjI3LS4zOS4yOS0uNjVjMC0uNTUtLjQ1LTEtMS0xek0xOSAxMUw5IDE5VjV6Ii8+PC9zdmc+" alt="关闭" class="close-panel" onclick="closeConfigPanel()">
        </div>
        <div class="config-form">
            <div class="form-group">
                <label class="form-label">用户头像（上传图片链接）</label>
                <input type="text" class="form-input" id="config-avatar" placeholder="输入图片URL" value="https://imgchr.com/i/6Z7X8K">
            </div>
            <div class="form-group">
                <label class="form-label">用户名称</label>
                <input type="text" class="form-input" id="config-name" placeholder="输入显示名称" value="小团同学">
            </div>
            <div class="form-group">
                <label class="form-label">邀请文案</label>
                <textarea class="form-textarea" id="config-desc" placeholder="输入邀请好友的文案">想喝奶茶啦，求好友赞助~</textarea>
            </div>
            <div class="form-group">
                <label class="form-label">商家名称</label>
                <input type="text" class="form-input" id="config-shop" placeholder="输入商家名称" value="蜜雪冰城（通运路店）">
            </div>
            <!-- 订单备注配置项 -->
            <div class="form-group">
                <label class="form-label">订单备注</label>
                <textarea class="form-textarea" id="config-order-note" placeholder="输入给代付人的留言">麻烦尽快付款哦，奶茶要趁热喝~</textarea>
            </div>
            <!-- 多商品配置区域 -->
            <div class="goods-config-area">
                <div class="goods-config-title">商品列表配置</div>
                <div id="goodsFormContainer">
                    <div class="single-goods-form">
                        <div class="form-group">
                            <label class="form-label">商品图片链接</label>
                            <input type="text" class="form-input goods-img-input" placeholder="输入图片URL" value="https://imgchr.com/i/7ZJvq1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">商品名称</label>
                            <input type="text" class="form-input goods-name-input" placeholder="输入商品名称" value="珍珠奶茶（中杯）">
                        </div>
                        <div class="goods-form-row">
                            <div class="form-group" style="flex: 1;">
                                <label class="form-label">商品单价</label>
                                <input type="number" step="0.01" class="form-input goods-price-input" placeholder="输入单价" value="12.50">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label class="form-label">数量</label>
                                <input type="number" min="1" class="form-input goods-count-input" placeholder="输入数量" value="1">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">商品备注</label>
                            <input type="text" class="form-input goods-remark-input" placeholder="输入备注" value="无需备注">
                        </div>
                        <button class="del-goods-form-btn" onclick="deleteGoodsForm(this)">删除该商品</button>
                    </div>
                    <div class="single-goods-form">
                        <div class="form-group">
                            <label class="form-label">商品图片链接</label>
                            <input type="text" class="form-input goods-img-input" placeholder="输入图片URL" value="https://imgchr.com/i/7ZJvq1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">商品名称</label>
                            <input type="text" class="form-input goods-name-input" placeholder="输入商品名称" value="脆筒冰淇淋">
                        </div>
                        <div class="goods-form-row">
                            <div class="form-group" style="flex: 1;">
                                <label class="form-label">商品单价</label>
                                <input type="number" step="0.01" class="form-input goods-price-input" placeholder="输入单价" value="3.00">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label class="form-label">数量</label>
                                <input type="number" min="1" class="form-input goods-count-input" placeholder="输入数量" value="1">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">商品备注</label>
                            <input type="text" class="form-input goods-remark-input" placeholder="输入备注" value="无需备注">
                        </div>
                        <button class="del-goods-form-btn" onclick="deleteGoodsForm(this)">删除该商品</button>
                    </div>
                </div>
                <button class="add-goods-form-btn" onclick="addGoodsForm()">+ 添加商品配置项</button>
            </div>
            <div class="form-group">
                <label class="form-label">微信收款码（上传图片链接）</label>
                <input type="text" class="form-input" id="config-wx-code" placeholder="输入微信收款码图片URL" required value="https://imgchr.com/i/8Z6g01">
            </div>
            <div class="form-group">
                <label class="form-label">支付宝收款码（上传图片链接）</label>
                <input type="text" class="form-input" id="config-ali-code" placeholder="输入支付宝收款码图片URL" required value="https://imgchr.com/i/8Z5a0e">
            </div>
            <button class="save-config" onclick="saveConfig()">保存配置并生效</button>
        </div>
    </div>

    <script>
        // 全局变量
        let countdownTimer = null;
        let totalSeconds = 15 * 60;
        let goodsIdCounter = 2;
        let isPaid = false;

        // 15分钟倒计时核心函数
        function startCountdown() {
            if (countdownTimer) clearInterval(countdownTimer);
            
            const hourEl = document.getElementById('time-h');
            const minuteEl = document.getElementById('time-m');
            const secondEl = document.getElementById('time-s');
            const payBtn = document.getElementById('payBtn');

            function updateDisplay() {
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                hourEl.textContent = hours.toString().padStart(2, '0');
                minuteEl.textContent = minutes.toString().padStart(2, '0');
                secondEl.textContent = seconds.toString().padStart(2, '0');
            }

            countdownTimer = setInterval(() => {
                if (totalSeconds <= 0 || isPaid) {
                    clearInterval(countdownTimer);
                    if(!isPaid){
                        payBtn.classList.add('disabled');
                        payBtn.disabled = true;
                        payBtn.textContent = '订单已超时';
                    }
                    return;
                }
                totalSeconds--;
                updateDisplay();
            }, 1000);
            updateDisplay();
        }

        // 计算订单总金额
        function calculateTotalAmount() {
            const priceInputs = document.querySelectorAll('.goods-price-input');
            const countInputs = document.querySelectorAll('.goods-count-input');
            let total = 0;
            for (let i = 0; i < priceInputs.length; i++) {
                const price = parseFloat(priceInputs[i].value) || 0;
                const count = parseInt(countInputs[i].value) || 1;
                total += price * count;
            }
            return total.toFixed(2);
        }

        // 渲染商品列表
        function renderGoodsList() {
            const goodsFormList = document.querySelectorAll('.single-goods-form');
            const goodsListEl = document.getElementById('goodsList');
            goodsListEl.innerHTML = '';

            goodsFormList.forEach((form, index) => {
                const imgUrl = form.querySelector('.goods-img-input').value;
                const name = form.querySelector('.goods-name-input').value;
                const price = parseFloat(form.querySelector('.goods-price-input').value) || 0;
                const count = parseInt(form.querySelector('.goods-count-input').value) || 1;
                const remark = form.querySelector('.goods-remark-input').value;

                const goodsItem = document.createElement('div');
                goodsItem.className = 'goods-item';
                goodsItem.innerHTML = `
                    <img src="${imgUrl}" alt="商品图片" class="goods-img" data-id="${index}">
                    <div class="goods-meta">
                        <div class="goods-name">${name}</div>
                        <div class="goods-price">¥${price.toFixed(2)}</div>
                        <div class="goods-count">${count}份 · ${remark}</div>
                        <div class="goods-del" onclick="deleteGoods(${index})">删除</div>
                    </div>
                `;
                goodsListEl.appendChild(goodsItem);
            });

            // 更新总金额
            document.getElementById('pay-amount').textContent = `¥${calculateTotalAmount()}`;
        }

        // 添加商品配置项
        function addGoodsForm() {
            const container = document.getElementById('goodsFormContainer');
            const newForm = document.createElement('div');
            newForm.className = 'single-goods-form';
            newForm.innerHTML = `
                <div class="form-group">
                    <label class="form-label">商品图片链接</label>
                    <input type="text" class="form-input goods-img-input" placeholder="输入图片URL" value="https://imgchr.com/i/7ZJvq1">
                </div>
                <div class="form-group">
                    <label class="form-label">商品名称</label>
                    <input type="text" class="form-input goods-name-input" placeholder="输入商品名称">
                </div>
                <div class="goods-form-row">
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">商品单价</label>
                        <input type="number" step="0.01" class="form-input goods-price-input" placeholder="输入单价" value="0.00">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">数量</label>
                        <input type="number" min="1" class="form-input goods-count-input" placeholder="输入数量" value="1">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">商品备注</label>
                    <input type="text" class="form-input goods-remark-input" placeholder="输入备注" value="无需备注">
                </div>
                <button class="del-goods-form-btn" onclick="deleteGoodsForm(this)">删除该商品</button>
            `;
            container.appendChild(newForm);
        }

        // 删除商品配置项
        function deleteGoodsForm(btn) {
            const form = btn.closest('.single-goods-form');
            if (document.querySelectorAll('.single-goods-form').length <= 1) {
                alert('至少保留一个商品！');
                return;
            }
            form.remove();
            renderGoodsList();
        }

        // 页面添加商品（预览区）
        function addGoods() {
            addGoodsForm();
            renderGoodsList();
        }

        // 页面删除商品（预览区）
        function deleteGoods(index) {
            const formList = document.querySelectorAll('.single-goods-form');
            if (formList.length <= 1) {
                alert('至少保留一个商品！');
                return;
            }
            formList[index].remove();
            renderGoodsList();
        }

        // 保存配置并重置倒计时
        function saveConfig() {
            const avatar = document.getElementById('config-avatar').value;
            const name = document.getElementById('config-name').value;
            const desc = document.getElementById('config-desc').value;
            const shop = document.getElementById('config-shop').value;
            const wxCode = document.getElementById('config-wx-code').value;
            const aliCode = document.getElementById('config-ali-code').value;
            const orderNote = document.getElementById('config-order-note').value;

            // 更新基础信息
            document.getElementById('avatar-img').src = avatar;
            document.getElementById('user-name').textContent = name;
            document.getElementById('user-desc').textContent = desc;
            document.getElementById('shop-name').textContent = shop;
            document.getElementById('wx-code-img').src = wxCode;
            document.getElementById('ali-code-img').src = aliCode;
            document.getElementById('orderNoteContent').textContent = orderNote || '无备注';

            // 重置支付状态
            isPaid = false;
            document.getElementById('payBtn').style.display = 'block';
            document.getElementById('paidBtn').style.display = 'none';
            document.getElementById('countdown').classList.remove('paid');
            document.getElementById('countdown').innerHTML = `支付剩余时间 <span id="time-h">00</span>:<span id="time-m">15</span>:<span id="time-s">00</span>`;

            // 渲染商品列表和总金额
            renderGoodsList();

            // 重置倒计时
            totalSeconds = 15 * 60;
            startCountdown();

            closeConfigPanel();
            alert('配置保存成功！倒计时已重置为15分钟');
        }

        // 显示/关闭配置面板
        function showConfigPanel() {
            document.getElementById('configPanel').style.display = 'block';
        }
        function closeConfigPanel() {
            document.getElementById('configPanel').style.display = 'none';
        }

        // 显示/关闭收款码弹窗
        function showPayModal() {
            const wxCode = document.getElementById('config-wx-code').value;
            const aliCode = document.getElementById('config-ali-code').value;
            if (!wxCode || !aliCode) {
                alert('请先在配置面板填写收款码链接！');
                showConfigPanel();
                return;
            }
            document.getElementById('payMask').style.display = 'block';
            document.getElementById('payModal').style.display = 'block';
        }
        function closePayModal() {
            document.getElementById('payMask').style.display = 'none';
            document.getElementById('payModal').style.display = 'none';
        }

        // 显示/关闭支付成功弹窗
        function showSuccessPopup() {
            isPaid = true;
            clearInterval(countdownTimer);
            
            // 更新页面状态
            document.getElementById('payBtn').style.display = 'none';
            document.getElementById('paidBtn').style.display = 'block';
            document.getElementById('countdown').classList.add('paid');
            document.getElementById('countdown').innerHTML = '<span style="font-weight:600;">✓ 订单已付款</span>';
            
            // 显示成功弹窗
            document.getElementById('successMask').style.display = 'block';
            document.getElementById('successPopup').style.display = 'block';
        }
        function closeSuccessPopup() {
            document.getElementById('successMask').style.display = 'none';
            document.getElementById('successPopup').style.display = 'none';
            closePayModal();
        }

        // 微信环境检测和转账引导
        function checkWechatEnv() {
            if (/MicroMessenger/i.test(navigator.userAgent)) {
                // 微信环境下显示转账引导弹窗
                showTransferModal();
            } else {
                // 非微信环境下显示收款码弹窗
                showPayModal();
            }
        }

        function showTransferModal() {
            // 更新弹窗中的金额和备注
            document.getElementById('transferAmount').textContent = document.getElementById('pay-amount').textContent;
            // 拼接所有商品名称作为备注
            const goodsNames = Array.from(document.querySelectorAll('.goods-name')).map(item => item.textContent).join('+');
            document.getElementById('transferNote').textContent = `代付订单：${goodsNames}`;
            document.getElementById('transferMask').style.display = 'block';
            document.getElementById('transferModal').style.display = 'block';
        }

        function closeTransferModal() {
            document.getElementById('transferMask').style.display = 'none';
            document.getElementById('transferModal').style.display = 'none';
        }

        function copyTransferNote() {
            const note = document.getElementById('transferNote').textContent;
            navigator.clipboard.writeText(note).then(() => {
                alert('转账备注已复制！请返回微信进行转账');
            }).catch(err => {
                alert('复制失败，请手动记录备注：' + note);
            });
        }

        // 分享功能
        function showSharePopup() {
            document.getElementById('shareMask').style.display = 'block';
            document.getElementById('sharePopup').style.display = 'block';
        }
        function hideSharePopup() {
            document.getElementById('shareMask').style.display = 'none';
            document.getElementById('sharePopup').style.display = 'none';
        }
        function shareToWechat() {
            if (/MicroMessenger/i.test(navigator.userAgent)) {
                alert('已唤起微信分享，请选择好友发送');
            } else {
                copyLink();
                alert('已复制链接，请打开微信粘贴给好友');
            }
            hideSharePopup();
        }
        function shareToQQ() {
            if (/QQ/i.test(navigator.userAgent)) {
                alert('已唤起QQ分享，请选择好友发送');
            } else {
                copyLink();
                alert('已复制链接，请打开QQ粘贴给好友');
            }
            hideSharePopup();
        }
        function copyLink() {
            const currentUrl = window.location.href;
            navigator.clipboard.writeText(currentUrl).then(() => {
                alert('链接复制成功！');
            }).catch(err => {
                alert('复制失败，请手动复制页面链接');
                console.error('复制失败:', err);
            });
        }

        // 转发功能
        function showForwardPopup() {
            document.getElementById('forwardMask').style.display = 'block';
            document.getElementById('forwardPopup').style.display = 'block';
        }
        function hideForwardPopup() {
            document.getElementById('forwardMask').style.display = 'none';
            document.getElementById('forwardPopup').style.display = 'none';
        }
        function forwardToWechat() {
            if (/MicroMessenger/i.test(navigator.userAgent)) {
                alert('已唤起微信转发，请选择好友发送');
            } else {
                copyForwardLink();
                alert('已复制转发链接，请打开微信粘贴给好友');
            }
            hideForwardPopup();
        }
        function forwardToQQ() {
            if (/QQ/i.test(navigator.userAgent)) {
                alert('已唤起QQ转发，请选择好友发送');
            } else {
                copyForwardLink();
                alert('已复制转发链接，请打开QQ粘贴给好友');
            }
            hideForwardPopup();
        }
        function copyForwardLink() {
            const forwardText = `【代付请求】${document.getElementById('user-name').textContent} 请求你帮忙支付订单：${window.location.href}`;
            navigator.clipboard.writeText(forwardText).then(() => {
                alert('转发链接复制成功！');
            }).catch(err => {
                alert('复制失败，请手动复制页面链接');
                console.error('复制失败:', err);
            });
        }

        // 页面加载时启动倒计时和渲染商品
        window.onload = function() {
            startCountdown();
            renderGoodsList();
        };
    </script>
</body>
</html>
