<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代付详情</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Helvetica Neue", Helvetica, Arial, sans-serif;
        }
        body {
            background-color: #f5f5f5;
            font-size: 14px;
        }
        /* 顶部导航 */
        .header {
            background-color: #fff;
            padding: 12px 15px;
            text-align: center;
            position: relative;
            border-bottom: 1px solid #f0f0f0;
        }
        .header .back {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: #333;
            text-decoration: none;
        }
        .header h2 {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }
        /* 用户信息区域 */
        .user-section {
            background-color: #f5f5f5;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }
        .user-info .name {
            font-size: 15px;
            font-weight: 500;
            color: #333;
            margin-bottom: 2px;
        }
        .user-info .desc {
            font-size: 12px;
            color: #999;
        }
        /* 付款卡片 */
        .pay-card {
            background-color: #fff;
            margin: 10px 15px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .pay-amount {
            padding: 25px 15px;
            text-align: center;
        }
        .pay-amount .label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }
        .pay-amount .money {
            font-size: 36px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .pay-amount .countdown {
            font-size: 12px;
            color: #999;
        }
        .pay-amount .countdown .time {
            background-color: #333;
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            margin: 0 2px;
        }
        /* 付款须知 */
        .notice {
            background-color: #fff9e8;
            margin: 0 15px 15px;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            color: #fa9d3b;
            line-height: 1.5;
        }
        /* 按钮区域 */
        .btn-area {
            padding: 0 15px 15px;
        }
        .send-btn {
            display: block;
            width: 100%;
            height: 44px;
            line-height: 44px;
            background-color: #ffd100;
            color: #333;
            border: none;
            border-radius: 22px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
        }
        .send-btn.disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .self-pay {
            text-align: center;
            margin-top: 10px;
            font-size: 12px;
            color: #999;
        }
        .self-pay a {
            color: #999;
            text-decoration: none;
        }
        /* 商品信息区域 */
        .goods-section {
            background-color: #fff;
            margin: 10px 15px;
            border-radius: 12px;
            padding: 15px;
        }
        .goods-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .shop-name {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }
        .hide-switch {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #999;
        }
        .goods-item {
            display: flex;
            gap: 10px;
        }
        .goods-img {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }
        .goods-info {
            flex: 1;
        }
        .goods-name {
            font-size: 14px;
            color: #333;
            margin-bottom: 4px;
            line-height: 1.3;
        }
        .goods-desc {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
        }
        .goods-price {
            font-size: 14px;
            color: #333;
            font-weight: 500;
            text-align: right;
        }
        /* 配置面板 */
        .config-panel {
            width: 90%;
            max-width: 400px;
            margin: 20px auto;
            padding: 15px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .config-panel h4 {
            font-size: 15px;
            color: #333;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #f0f0f0;
        }
        .config-item {
            margin-bottom: 10px;
        }
        .config-item label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        .config-item input, .config-item select {
            width: 100%;
            height: 35px;
            padding: 0 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .config-item .upload-btn {
            display: inline-block;
            padding: 6px 12px;
            background-color: #1677ff;
            color: #fff;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 5px;
        }
        .qrcode-container {
            text-align: center;
            margin: 15px 0;
        }
        #qrcode {
            display: inline-block;
            margin: 10px 0;
        }
        .config-btns {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .config-btn {
            flex: 1;
            height: 35px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }
        .save-config {
            background-color: #ff6700;
            color: #fff;
        }
        .load-config {
            background-color: #666;
            color: #fff;
        }
        .del-config {
            background-color: #ff4444;
            color: #fff;
        }
        .qrcode-btn {
            background-color: #07c160;
            color: #fff;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- 顶部导航 -->
    <div class="header">
        <a href="#" class="back">←</a>
        <h2>代付详情</h2>
    </div>

    <!-- 用户信息 -->
    <div class="user-section">
        <img id="avatar-img" src="https://picsum.photos/48/48" alt="头像" class="avatar">
        <div class="user-info">
            <div id="user-name" class="name">永远</div>
            <div id="user-desc" class="desc">Hi～你和我的距离只差一顿外卖～</div>
        </div>
    </div>

    <!-- 付款卡片 -->
    <div class="pay-card">
        <div class="pay-amount">
            <div class="label">需付款</div>
            <div id="pay-amount" class="money">¥26.50</div>
            <div class="countdown">
                支付剩余时间
                <span class="time" id="time-h">00</span>:
                <span class="time" id="time-m">14</span>:
                <span class="time" id="time-s">59</span>
            </div>
        </div>
        <div class="notice">
            1.代付订单创建成功后15分钟内未付款，订单会自动取消，你可以重新下单。<br>
            2.当代付订单退款成功后，实付金额将原路退还代付人。
        </div>
        <div class="btn-area">
            <button class="send-btn" onclick="window.open(document.getElementById('wx-pay-link').value)">发给微信好友</button>
            <div class="self-pay"><a href="#" id="self-pay-link">自己付款 ></a></div>
        </div>
    </div>

    <!-- 商品信息 -->
    <div class="goods-section">
        <div class="goods-header">
            <div id="shop-name" class="shop-name">华莱士·全鸡汉堡（莘县燕塔...）</div>
            <div class="hide-switch">
                <span>对好友隐藏商品</span>
                <input type="checkbox">
            </div>
        </div>
        <div class="goods-item">
            <img id="goods-img" src="https://picsum.photos/60/60" alt="商品图片" class="goods-img">
            <div class="goods-info">
                <div id="goods-name" class="goods-name">【直播专享】两堡一卷豪...</div>
                <div id="goods-desc" class="goods-desc">华香脆骨串 X1, 辣味鸡肉卷 X...</div>
            </div>
            <div id="goods-price" class="goods-price">¥50</div>
        </div>
    </div>

    <!-- 配置面板 -->
    <div class="config-panel">
        <h4>多套配置管理</h4>
        <div class="config-item">
            <label>配置名称（如：华莱士订单/店铺A）</label>
            <input type="text" id="config-name" placeholder="给当前配置起个名字">
        </div>
        <div class="config-item">
            <label>选择已保存的配置</label>
            <select id="config-select" onchange="loadSelectedConfig()">
                <option value="">-- 请选择配置 --</option>
            </select>
        </div>
        <div class="config-item">
            <label>头像</label>
            <input type="text" id="avatar-input" placeholder="输入头像图片链接">
            <div class="upload-btn" onclick="document.getElementById('avatar-upload').click()">从相册选择</div>
            <input type="file" id="avatar-upload" accept="image/*" style="display: none;" onchange="previewImage(this, 'avatar-img', 'avatar-input')">
        </div>
        <div class="config-item">
            <label>用户名</label>
            <input type="text" id="username-input" placeholder="输入显示的用户名">
        </div>
        <div class="config-item">
            <label>用户描述</label>
            <input type="text" id="userdesc-input" placeholder="输入用户个性描述">
        </div>
        <div class="config-item">
            <label>代付金额</label>
            <input type="text" id="amount-input" placeholder="例如：26.50">
        </div>
        <div class="config-item">
            <label>商家店铺名</label>
            <input type="text" id="shopname-input" placeholder="输入商家名称">
        </div>
        <div class="config-item">
            <label>商品图片</label>
            <input type="text" id="goodsimg-input" placeholder="输入商品图片链接">
            <div class="upload-btn" onclick="document.getElementById('goodsimg-upload').click()">从相册选择</div>
            <input type="file" id="goodsimg-upload" accept="image/*" style="display: none;" onchange="previewImage(this, 'goods-img', 'goodsimg-input')">
        </div>
        <div class="config-item">
            <label>商品名称</label>
            <input type="text" id="goodsname-input" placeholder="输入商品名称">
        </div>
        <div class="config-item">
            <label>商品描述</label>
            <input type="text" id="goodsdesc-input" placeholder="输入商品描述">
        </div>
        <div class="config-item">
            <label>商品价格</label>
            <input type="text" id="goodsprice-input" placeholder="输入商品价格">
        </div>
        <div class="config-item">
            <label>微信收款链接</label>
            <input type="text" id="wx-pay-link" placeholder="输入微信收款码链接">
        </div>
        <div class="config-item">
            <label>分享页面URL（需先部署到服务器）</label>
            <input type="text" id="share-url" placeholder="例如：https://your-domain.com/meituan-pay.html">
        </div>
        <div class="qrcode-container">
            <div id="qrcode"></div>
            <button class="config-btn qrcode-btn" onclick="generateQRCode()">生成分享二维码</button>
        </div>
        <div class="config-btns">
            <button class="config-btn save-config" onclick="saveConfig()">保存当前配置</button>
            <button class="config-btn load-config" onclick="loadSelectedConfig()">加载选中配置</button>
            <button class="config-btn del-config" onclick="delSelectedConfig()">删除选中配置</button>
        </div>
    </div>

    <script>
        // 初始化
        window.onload = function() {
            loadAllConfigNames();
            startCountdown();
        }

        // 15分钟倒计时功能
        function startCountdown() {
            let totalSeconds = 15 * 60; // 15分钟
            const timer = setInterval(() => {
                if (totalSeconds <= 0) {
                    clearInterval(timer);
                    document.getElementById('time-h').textContent = '00';
                    document.getElementById('time-m').textContent = '00';
                    document.getElementById('time-s').textContent = '00';
                    document.querySelector('.send-btn').classList.add('disabled');
                    document.querySelector('.send-btn').onclick = null;
                    alert('订单已超时取消');
                    return;
                }
                totalSeconds--;
                const hours = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
                const minutes = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
                const seconds = (totalSeconds % 60).toString().padStart(2, '0');
                document.getElementById('time-h').textContent = hours;
                document.getElementById('time-m').textContent = minutes;
                document.getElementById('time-s').textContent = seconds;
            }, 1000);
        }

        // 本地相册选图预览
        function previewImage(input, previewId, inputId) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // 预览图片
                    document.getElementById(previewId).src = e.target.result;
                    // 把图片的base64编码存入输入框
                    document.getElementById(inputId).value = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        }

        // 生成分享二维码
        function generateQRCode() {
            const shareUrl = document.getElementById('share-url').value.trim();
            if (!shareUrl) {
                alert('请先填写分享页面的URL！');
                return;
            }
            const qrcodeElement = document.getElementById('qrcode');
            qrcodeElement.innerHTML = '';
            QRCode.toCanvas(qrcodeElement, shareUrl, {
                width: 128,
                color: {
                    dark: '#333333',
                    light: '#ffffff'
                }
            }, function (error) {
                if (error) console.error(error)
            });
        }

        // 保存当前配置
        function saveConfig() {
            const configName = document.getElementById('config-name').value.trim();
            if (!configName) {
                alert('请输入配置名称！');
                return;
            }
            const config = {
                avatar: document.getElementById('avatar-input').value,
                username: document.getElementById('username-input').value,
                userdesc: document.getElementById('userdesc-input').value,
                amount: document.getElementById('amount-input').value,
                shopname: document.getElementById('shopname-input').value,
                goodsimg: document.getElementById('goodsimg-input').value,
                goodsname: document.getElementById('goodsname-input').value,
                goodsdesc: document.getElementById('goodsdesc-input').value,
                goodsprice: document.getElementById('goodsprice-input').value,
                wxLink: document.getElementById('wx-pay-link').value,
                shareUrl: document.getElementById('share-url').value
            };
            let allConfigs = JSON.parse(localStorage.getItem('allMeituanPayConfigs')) || {};
            allConfigs[configName] = config;
            localStorage.setItem('allMeituanPayConfigs', JSON.stringify(allConfigs));
            alert('配置保存成功！');
            loadAllConfigNames();
            loadConfigByName(configName);
        }

        // 加载所有配置名称到下拉框
        function loadAllConfigNames() {
            const select = document.getElementById('config-select');
            select.innerHTML = '<option value="">-- 请选择配置 --</option>';
            const allConfigs = JSON.parse(localStorage.getItem('allMeituanPayConfigs')) || {};
            for (let name in allConfigs) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            }
        }

        // 加载选中的配置
        function loadSelectedConfig() {
            const select = document.getElementById('config-select');
            const selectedName = select.value;
            if (!selectedName) return;
            loadConfigByName(selectedName);
        }

        // 根据名称加载配置
        function loadConfigByName(configName) {
            const allConfigs = JSON.parse(localStorage.getItem('allMeituanPayConfigs')) || {};
            const config = allConfigs[configName];
            if (!config) {
                alert('配置不存在！');
                return;
            }
            // 更新界面
            if(config.avatar) document.getElementById('avatar-img').src = config.avatar;
            if(config.username) document.getElementById('user-name').innerText = config.username;
            if(config.userdesc) document.getElementById('user-desc').innerText = config.userdesc;
            if(config.amount) document.getElementById('pay-amount').innerText = '¥' + config.amount;
            if(config.shopname) document.getElementById('shop-name').innerText = config.shopname;
            if(config.goodsimg) document.getElementById('goods-img').src = config.goodsimg;
            if(config.goodsname) document.getElementById('goods-name').innerText = config.goodsname;
            if(config.goodsdesc) document.getElementById('goods-desc').innerText = config.goodsdesc;
            if(config.goodsprice) document.getElementById('goods-price').innerText = '¥' + config.goodsprice;
            // 更新输入框
            document.getElementById('config-name').value = configName;
            document.getElementById('avatar-input').value = config.avatar || '';
            document.getElementById('username-input').value = config.username || '';
            document.getElementById('userdesc-input').value = config.userdesc || '';
            document.getElementById('amount-input').value = config.amount || '';
            document.getElementById('shopname-input').value = config.shopname || '';
            document.getElementById('goodsimg-input').value = config.goodsimg || '';
            document.getElementById('goodsname-input').value = config.goodsname || '';
            document.getElementById('goodsdesc-input').value = config.goodsdesc || '';
            document.getElementById('goodsprice-input').value = config.goodsprice || '';
            document.getElementById('wx-pay-link').value = config.wxLink || '';
            document.getElementById('share-url').value = config.shareUrl || '';
            alert(`已加载配置【${configName}】`);
        }

        // 删除选中的配置
        function delSelectedConfig() {
            const select = document.getElementById('config-select');
            const selectedName = select.value;
            if (!selectedName) {
                alert('请选择要删除的配置！');
                return;
            }
            if (!confirm(`确定删除配置【${selectedName}】吗？`)) return;
            let allConfigs = JSON.parse(localStorage.getItem('allMeituanPayConfigs')) || {};
            delete allConfigs[selectedName];
            localStorage.setItem('allMeituanPayConfigs', JSON.stringify(allConfigs));
            alert('配置已删除！');
            loadAllConfigNames();
            // 清空输入框
            document.getElementById('config-name').value = '';
            document.getElementById('avatar-input').value = '';
            document.getElementById('username-input').value = '';
            document.getElementById('userdesc-input').value = '';
            document.getElementById('amount-input').value = '';
            document.getElementById('shopname-input').value = '';
            document.getElementById('goodsimg-input').value = '';
            document.getElementById('goodsname-input').value = '';
            document.getElementById('goodsdesc-input').value = '';
            document.getElementById('goodsprice-input').value = '';
            document.getElementById('wx-pay-link').value = '';
            document.getElementById('share-url').value = '';
            document.getElementById('qrcode').innerHTML = '';
        }
    </script>
</body>
</html>